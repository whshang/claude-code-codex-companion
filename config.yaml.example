# -----------------------------------------------------------------
# Claude Code Codex Companion - Configuration Example
# -----------------------------------------------------------------
# This file provides an example configuration.
# Please copy it to 'config.yaml' and modify it to your needs.

# Address for the proxy server to listen on
server:
  host: "127.0.0.1"
  port: 8080
  # Whether to automatically sort endpoints based on performance (currently disabled)
  auto_sort_endpoints: false

# --- Endpoint URLs ---
# Provide the full base URL and API key for each upstream service.
# The system will automatically append the correct path (e.g., /v1/chat/completions) if it's missing.
# It is recommended to provide the full URL for clarity.

# For Anthropic models (proxied via /claude)
# Example URL: https://api.anthropic.com/v1/messages
anthropic_endpoint:
  url: ""
  api_key: "YOUR_ANTHROPIC_API_KEY_HERE"

# For OpenAI /chat/completions format (proxied via /openai_chat)
# Use this for modern models like GPT-4, or providers like 88code.
# Example URL: https://api.openai.com/v1/chat/completions
openai_chat_endpoint:
  url: ""
  api_key: "YOUR_OPENAI_API_KEY_HERE"

# For legacy OpenAI /responses format (proxied via /openai_responses)
# This is optional and only needed for compatibility with older models.
# Example URL: https://api.example.com/v1/responses
#
# openai_responses_endpoint:
#   url: ""
#   api_key: "YOUR_API_KEY_FOR_RESPONSES_ENDPOINT"


# --- Core Service Configurations ---

logging:
  level: "info" # "debug", "info", "warn", "error"
  log_request_types: "failed" # "all", "failed", "none"
  log_request_body: "truncated" # "full", "truncated", "none"
  log_response_body: "truncated" # "full", "truncated", "none"
  log_directory: "./logs"

# Network timeouts for proxying and health checks
timeouts:
  tls_handshake: "10s"
  response_header: "60s"
  idle_connection: "90s"
  health_check_timeout: "30s"
  check_interval: "30s"
  recovery_threshold: 1

# Endpoint health checking and blacklisting configuration
blacklist:
  enabled: true
  auto_blacklist: true
  business_error_safe: true # Don't blacklist on 4xx errors
  config_error_safe: false
  server_error_safe: false # Blacklist on 5xx errors
  sse_validation_safe: false

# Internationalization (i18n) settings
i18n:
  enabled: true
  default_language: "en" # "en", "zh"
  locales_path: "web/locales"

# --- Advanced Configurations ---

# HTTP client settings
http_client:
  max_conns_per_host: 10
  write_buffer_size: 4096
  read_buffer_size: 4096
  force_attempt_http2: true
  enable_compression: true
  enable_keep_alive: true

# Conversion settings (mostly deprecated)
conversion:
  adapter_mode: "unified" # "legacy", "unified", "auto"
  validate_mode_switch: false
  failback_threshold: 30

# Tagging system for routing requests
tagging:
  pipeline_timeout: "5s"
  taggers: []
  # Example tagger:
  # - name: "claude_model_tagger"
  #   type: "body-json"
  #   tag: "model:claude"
  #   enabled: true
  #   config:
  #     json_path: "model"
  #     value_pattern: "claude-*"
