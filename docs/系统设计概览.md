# 系统设计概览 | System Design Overview

## 中文

CCCC 是多协议 AI 代理，核心能力包括端点管理、格式转换、模型重写、健康检查与日志分析。本篇作为导航，便于快速定位实现位置。

### 核心组件

- **Endpoint Manager** (`internal/endpoint`)：维护优先级、标签、健康状态，并记录 `supports_responses`、`openai_preference` 等学习结果。  
- **Format Conversion** (`internal/conversion`)：实现 Anthropic ↔ OpenAI 请求/响应转换及 SSE 流式转换。  
- **Proxy Logic** (`internal/proxy`)：负责请求入口、降级状态机、工具增强、日志写入与配置持久化。  
- **Model Rewrite** (`internal/modelrewrite`)：通配符映射与响应回写。  
- **Tagging & Routing** (`internal/tagging`)：结合内置与 Starlark Tagger 进行路由。  
- **Health & Statistics** (`internal/health`, `internal/statistics`)：执行周期性探测与指标聚合。  

### 配置与客户端

- [《智能端点配置指南》](智能端点配置指南.md)：`config.yaml` 字段说明。  
- [《Codex 配置指南》](Codex配置指南.md)：客户端脚本示例。  
- [《模型重写设计》](模型重写设计.md)。  

### 可观测性

- [《调试信息导出》](调试信息导出.md)：导出调试包。  
- [《功能验证步骤》](功能验证步骤.md)：人工验证清单。  

### 开发参考

- [《SSE 重构设计》](SSE重构设计.md)。  
- [《Codex 工具调用修复说明》](Codex流式工具调用修复_2025-10-10.md)。  
- [《学习持久化实现》](学习持久化实现.md)。  

## English

CCCC is a multi-protocol AI proxy offering endpoint management, format conversion, model rewriting, health checks, and logging. This page guides you to the relevant modules.

### Core Components

- **Endpoint Manager** (`internal/endpoint`): manages priorities, tags, health, and learned values (`supports_responses`, `openai_preference`).  
- **Format Conversion** (`internal/conversion`): handles Anthropic ↔ OpenAI conversions and SSE streaming.  
- **Proxy Logic** (`internal/proxy`): entry point, downgrade state machine, tool enhancement, logging, and persistence.  
- **Model Rewrite** (`internal/modelrewrite`): wildcard mapping and response rewriting.  
- **Tagging & Routing** (`internal/tagging`): built-in and Starlark taggers for routing decisions.  
- **Health & Statistics** (`internal/health`, `internal/statistics`): periodic probes and metric aggregation.  

### Configuration & Clients

- [Smart Endpoint Configuration Guide](智能端点配置指南.md).  
- [Codex Configuration Guide](Codex配置指南.md).  
- [Model Rewrite Design](模型重写设计.md).  

### Observability

- [Debug Export](调试信息导出.md).  
- [Verification Steps](功能验证步骤.md).  

### Development Notes

- [SSE Refactor Design](SSE重构设计.md).  
- [Codex Tool Call Streaming Fix](Codex流式工具调用修复_2025-10-10.md).  
- [Learning Persistence Implementation](学习持久化实现.md).  
