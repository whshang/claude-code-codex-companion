<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}}</title>
    <link href="/static/vendor/bootstrap/bootstrap.min.css" rel="stylesheet">
    <link href="/static/vendor/font-awesome/all.min.css" rel="stylesheet">
    <link href="/static/shared.css" rel="stylesheet">
    <link href="/static/utils.css" rel="stylesheet">
    <link href="/static/help.css" rel="stylesheet">
</head>
<body>
    <!-- Compact Hero Section -->
    <div class="hero-section py-4" style="min-height: auto;">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-9">
                    <h2 class="mb-2">
                        <i class="fas fa-robot text-primary"></i>
                        <span data-t="cccc_help">CCCC 统一配置向导</span>
                    </h2>
                    <p class="mb-2 lead" style="font-size: 1.1rem;">
                        <span data-t="setup_guide_cccc">30秒完成 Claude Code 和 Codex 配置</span>
                    </p>
                    <div class="d-flex gap-2">
                        <a href="/admin/" class="btn btn-sm btn-outline-light">
                            <i class="fas fa-cog"></i> 管理面板
                        </a>
                        <a href="/admin/endpoints" class="btn btn-sm btn-outline-light">
                            <i class="fas fa-server"></i> 端点配置
                        </a>
                    </div>
                </div>
                <div class="col-md-3 text-center">
                    <i class="fas fa-terminal fa-2x icon-hero" style="font-size: 3rem;"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Quick Status Check -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="alert alert-info py-2 mb-0">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-info-circle me-2"></i>
                        <span class="small">确保已安装 Claude Code 或 Codex，并拥有可用的 API 密钥</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Setup Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card border-success">
                    <div class="card-header bg-success text-white py-3">
                        <h5 class="mb-0">
                            <i class="fas fa-bolt"></i>
                            快速操作
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                            <a href="/admin/" class="btn btn-outline-primary flex-fill">
                                <i class="fas fa-tachometer-alt"></i> 控制台
                            </a>
                            <a href="/admin/endpoints" class="btn btn-outline-info flex-fill">
                                <i class="fas fa-list"></i> 端点列表
                            </a>
                            <a href="/admin/logs" class="btn btn-outline-warning flex-fill">
                                <i class="fas fa-history"></i> 请求日志
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration Options -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card border-primary">
                    <div class="card-header bg-primary text-white py-3">
                        <h5 class="mb-0">
                            <i class="fas fa-cogs"></i>
                            一键配置选项
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-4">
                            <!-- Claude Code Only -->
                            <div class="col-md-4">
                                <div class="card h-100 border-primary">
                                    <div class="card-body text-center">
                                        <i class="fas fa-code fa-2x text-primary mb-3"></i>
                                        <h5 class="card-title text-primary">Claude Code</h5>
                                        <p class="card-text small">仅配置 Claude Code 客户端</p>
                                        <div class="code-block small mb-3" style="font-size: 0.75rem; padding: 0.75rem; white-space: pre-wrap; overflow-x: auto;">
./cccc-setup-claude-code.sh --url {{.BaseURL}} --key YOUR_API_KEY
                                        </div>
                                        <button class="btn btn-primary btn-sm" onclick="downloadConfigScript('claude-code')">
                                            <i class="fas fa-download"></i> 下载脚本
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Codex Only -->
                            <div class="col-md-4">
                                <div class="card h-100 border-success">
                                    <div class="card-body text-center">
                                        <i class="fas fa-terminal fa-2x text-success mb-3"></i>
                                        <h5 class="card-title text-success">Codex</h5>
                                        <p class="card-text small">仅配置 Codex 客户端</p>
                                        <div class="code-block small mb-3" style="font-size: 0.75rem; padding: 0.75rem; white-space: pre-wrap; overflow-x: auto;">
./cccc-setup-codex.sh --url {{.BaseURL}} --key YOUR_API_KEY
                                        </div>
                                        <button class="btn btn-success btn-sm" onclick="downloadConfigScript('codex')">
                                            <i class="fas fa-download"></i> 下载脚本
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Both Together -->
                            <div class="col-md-4">
                                <div class="card h-100 border-info">
                                    <div class="card-body text-center">
                                        <i class="fas fa-sync-alt fa-2x text-info mb-3"></i>
                                        <h5 class="card-title text-info">同时配置</h5>
                                        <p class="card-text small">一次性配置 Claude Code 和 Codex</p>
                                        <div class="code-block small mb-3" style="font-size: 0.75rem; padding: 0.75rem; white-space: pre-wrap; overflow-x: auto;">
./cccc-setup.sh --url {{.BaseURL}} --key YOUR_API_KEY
                                        </div>
                                        <button class="btn btn-info btn-sm" onclick="downloadConfigScript('unified')">
                                            <i class="fas fa-download"></i> 下载脚本
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Endpoint Configuration -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card border-warning">
                    <div class="card-header bg-warning text-dark py-3">
                        <h5 class="mb-0">
                            <i class="fas fa-server"></i>
                            端点配置指南
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6><i class="fas fa-plug text-primary"></i> 端点配置说明</h6>
                                <p class="small">端点配置允许您设置多个 API 提供商，系统会根据优先级自动选择可用的端点：</p>
                                <ul class="small">
                                    <li><strong>添加端点:</strong> 可添加多个同类型或不同类型 API 提供商</li>
                                    <li><strong>优先级调整:</strong> 拖拽端点调整优先级顺序</li>
                                    <li><strong>标签设置:</strong> 为端点设置标签以便识别</li>
                                    <li><strong>健康检查:</strong> 系统自动检测端点可用性</li>
                                </ul>

                                <h6 class="mt-3"><i class="fas fa-cog text-success"></i> 参数含义</h6>
                                <ul class="small">
                                    <li><strong>URL:</strong> API 提供商的基础地址 (如 https://api.openai.com)</li>
                                    <li><strong>路径:</strong> API 路径前缀 (如 /v1，/chat/completions)</li>
                                    <li><strong>认证密钥:</strong> API 访问密钥</li>
                                    <li><strong>优先级:</strong> 数字越小优先级越高</li>
                                    <li><strong>标签:</strong> 自定义标签用于识别端点</li>
                                    <li><strong>超时:</strong> 请求超时时间（毫秒）</li>
                                </ul>
                            </div>

                            <div class="col-md-6">
                                <h6><i class="fas fa-wand-magic-sparkles text-info"></i> 高级配置</h6>
                                <ul class="small">
                                    <li><strong>模型映射:</strong> 将请求模型名映射到实际模型名</li>
                                    <li><strong>重写规则:</strong> 自定义请求/响应内容重写</li>
                                    <li><strong>负载均衡:</strong> 多端点之间的负载分配策略</li>
                                    <li><strong>故障转移:</strong> 主端点失败时自动切换策略</li>
                                </ul>

                                <div class="alert alert-info small mt-3">
                                    <i class="fas fa-lightbulb"></i> <strong>提示:</strong> 建议配置 2-3 个端点以确保高可用性。在管理面板中可以随时调整端点配置。
                                </div>

                                <div class="text-center mt-3">
                                    <a href="/admin/endpoints" class="btn btn-warning">
                                        <i class="fas fa-cogs"></i> 配置端点
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Manual Configuration (Expanded, not collapsible) -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card border-secondary">
                    <div class="card-header bg-secondary text-white py-3">
                        <h5 class="mb-0">
                            <i class="fas fa-tools"></i>
                            手动配置（高级用户）
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-primary mb-3">
                                    <i class="fas fa-code"></i> Claude Code 手动配置
                                </h6>
                                <p class="small mb-2">编辑 <code>~/.claude/settings.json</code> 文件：</p>
                                <div class="code-block small mb-3" style="font-size: 0.75rem; padding: 0.75rem; white-space: pre-wrap; overflow-x: auto;">
{
  "env": {
    "ANTHROPIC_BASE_URL": "{{.BaseURL}}",
    "ANTHROPIC_AUTH_TOKEN": "YOUR_API_KEY",
    "CLAUDE_CODE_MAX_OUTPUT_TOKENS": 20000,
    "DISABLE_TELEMETRY": 1,
    "DISABLE_ERROR_REPORTING": 1,
    "CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC": 1,
    "CLAUDE_BASH_MAINTAIN_PROJECT_WORKING_DIR": 1,
    "MAX_THINKING_TOKENS": 12000
  },
  "model": "sonnet"
}
                                </div>

                                <h6 class="text-muted mt-4">配置参数说明</h6>
                                <ul class="small">
                                    <li><strong>ANTHROPIC_BASE_URL:</strong> 指向 CCCC 代理服务器地址</li>
                                    <li><strong>ANTHROPIC_AUTH_TOKEN:</strong> API 认证令牌</li>
                                    <li><strong>CLAUDE_CODE_MAX_OUTPUT_TOKENS:</strong> 最大输出 token 数量</li>
                                    <li><strong>DISABLE_TELEMETRY:</strong> 禁用遥测数据</li>
                                    <li><strong>CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC:</strong> 禁用非必要流量</li>
                                </ul>
                            </div>

                            <div class="col-md-6">
                                <h6 class="text-success mb-3">
                                    <i class="fas fa-terminal"></i> Codex 手动配置
                                </h6>
                                <p class="small mb-2">编辑 <code>~/.codex/config.toml</code> 文件：</p>
                                <div class="code-block small mb-3" style="font-size: 0.75rem; padding: 0.75rem; white-space: pre-wrap; overflow-x: auto;">
model_provider = "cccc"
model = "gpt-5-codex"
model_reasoning_effort = "high"

[Model_providers.cccc]
name = "cccc"
base_url = "{{.BaseURL}}/v1"
wire_api = "responses"
env_key = "OPENAI_API_KEY"
                                </div>

                                <p class="small mb-2">编辑 <code>~/.codex/auth.json</code> 文件：</p>
                                <div class="code-block small mb-3" style="font-size: 0.75rem; padding: 0.75rem; white-space: pre-wrap; overflow-x: auto;">
{
  "OPENAI_API_KEY": "YOUR_API_KEY",
  "CCCC_API_KEY": "YOUR_API_KEY"
}
                                </div>

                                <h6 class="text-muted mt-4">配置参数说明</h6>
                                <ul class="small">
                                    <li><strong>model_provider:</strong> 模型提供商名称</li>
                                    <li><strong>model:</strong> 使用的模型名称</li>
                                    <li><strong>base_url:</strong> API 基础地址 (需添加 /v1 后缀)</li>
                                    <li><strong>wire_api:</strong> API 类型 (responses 表示响应格式)</li>
                                    <li><strong>env_key:</strong> 环境变量中使用的密钥名称</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="mt-5 py-3 bg-light border-top">
        <div class="container text-center text-muted">
            <a href="https://github.com/whshang/claude-code-codex-companion" target="_blank" class="text-decoration-none text-muted">
                Claude Code Codex Companion
            </a>
        </div>
    </footer>

    <script src="/static/vendor/bootstrap/bootstrap.bundle.min.js"></script>
    <script src="/static/i18n.js"></script>
    <script src="/static/shared.js"></script>
    <script>
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            element.setSelectionRange(0, 99999);
            document.execCommand('copy');

            // 显示复制成功提示
            const button = element.nextElementSibling;
            const originalHTML = button.innerHTML;
            button.innerHTML = '<i class="fas fa-check"></i> 已复制';
            button.classList.remove('btn-outline-secondary');
            button.classList.add('btn-success');

            setTimeout(() => {
                button.innerHTML = originalHTML;
                button.classList.remove('btn-success');
                button.classList.add('btn-outline-secondary');
            }, 2000);
        }

        // Download configuration scripts
        function downloadConfigScript(type) {
            const baseUrl = window.location.protocol + '//' + window.location.host;
            let scriptContent, filename;

            if (type === 'claude-code') {
                filename = 'cccc-setup-claude-code.sh';
                scriptContent = `#!/bin/bash

# CCCC (Claude Code Codex Companion) Configuration Script for Claude Code
# This script configures Claude Code to use your CCCC proxy instance

set -e

# Default values
DEFAULT_BASE_URL="${baseUrl}"
CLAUDE_CONFIG_DIR="$HOME/.claude"
CLAUDE_SETTINGS_FILE="$CLAUDE_CONFIG_DIR/settings.json"

# Function to create Claude Code settings
create_settings() {
    local base_url="$1"
    local api_key="$2"

    mkdir -p "$CLAUDE_CONFIG_DIR"

    cat > "$CLAUDE_SETTINGS_FILE" << EOF
{
  "env": {
    "ANTHROPIC_BASE_URL": "${base_url}",
    "ANTHROPIC_AUTH_TOKEN": "$api_key",
    "CLAUDE_CODE_MAX_OUTPUT_TOKENS": 20000,
    "DISABLE_TELEMETRY": 1,
    "DISABLE_ERROR_REPORTING": 1,
    "CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC": 1,
    "CLAUDE_BASH_MAINTAIN_PROJECT_WORKING_DIR": 1,
    "MAX_THINKING_TOKENS": 12000
  },
  "model": "sonnet"
}
EOF

    echo "Claude Code settings created successfully"
}

# Main function
main() {
    echo "CCCC (Claude Code Codex Companion) Configuration Script for Claude Code"
    echo "======================================================="
    echo

    # Interactive mode
    echo "交互式配置模式"
    echo

    # Get base URL
    read -p "Enter CCCC proxy URL [${DEFAULT_BASE_URL}]: " base_url
    base_url="${base_url:-$DEFAULT_BASE_URL}"

    # Get API key
    while [ -z "$api_key" ]; do
        read -p "Enter your API key: " api_key
        if [ -z "$api_key" ]; then
            echo "API key is required"
        fi
    done

    echo
    echo "配置信息："
    echo "  代理地址: $base_url"
    echo "  API 密钥: ${api_key:0:8}...${api_key: -4}"
    echo

    # Create settings
    create_settings "$base_url" "$api_key"

    echo
    echo "✅ Claude Code 配置完成！"
    echo "配置文件位置: $CLAUDE_SETTINGS_FILE"
}

# Run main function
main "$@"`;
            } else if (type === 'codex') {
                filename = 'cccc-setup-codex.sh';
                scriptContent = `#!/bin/bash

# CCCC (Claude Code Codex Companion) Configuration Script for Codex
# This script configures Codex to use your CCCC proxy instance

set -e

# Default values
DEFAULT_BASE_URL="${baseUrl}"

# Function to create Codex configuration
create_codex_config() {
    local base_url="$1"
    local api_key="$2"

    # Create config directory if it doesn't exist
    mkdir -p "$HOME/.codex"

    # Create config.toml
    cat > "$HOME/.codex/config.toml" << EOF
model_provider = "cccc"
model = "gpt-5-codex"
model_reasoning_effort = "high"

[Model_providers.cccc]
name = "cccc"
base_url = "${base_url}/v1"
wire_api = "responses"
env_key = "OPENAI_API_KEY"
EOF

    # Create auth.json
    cat > "$HOME/.codex/auth.json" << EOF
{
  "OPENAI_API_KEY": "$api_key",
  "CCCC_API_KEY": "$api_key"
}
EOF

    echo "Codex configuration created successfully"
}

# Main function
main() {
    echo "CCCC (Claude Code Codex Companion) Configuration Script for Codex"
    echo "======================================="
    echo

    # Interactive mode
    echo "交互式配置模式"
    echo

    # Get base URL
    read -p "Enter CCCC proxy URL [${DEFAULT_BASE_URL}]: " base_url
    base_url="${base_url:-$DEFAULT_BASE_URL}"

    # Get API key
    while [ -z "$api_key" ]; do
        read -p "Enter your API key: " api_key
        if [ -z "$api_key" ]; then
            echo "API key is required"
        fi
    done

    echo
    echo "配置信息："
    echo "  代理地址: $base_url"
    echo "  API 密钥: ${api_key:0:8}...${api_key: -4}"
    echo

    # Create configuration
    create_codex_config "$base_url" "$api_key"

    echo
    echo "✅ Codex 配置完成！"
    echo "配置文件位置: $HOME/.codex/config.toml"
}

# Run main function
main "$@"`;
            } else {
                // Unified script
                filename = 'cccc-setup.sh';
                scriptContent = `#!/bin/bash

# CCCC (Claude Code Codex Companion) Unified Configuration Script
# This script configures both Claude Code and Codex to use your CCCC proxy instance

set -e

# Default values
DEFAULT_BASE_URL="${baseUrl}"

# Function to create Claude Code settings
create_claude_settings() {
    local base_url="$1"
    local api_key="$2"

    mkdir -p "$HOME/.claude"

    cat > "$HOME/.claude/settings.json" << EOF
{
  "env": {
    "ANTHROPIC_BASE_URL": "$base_url",
    "ANTHROPIC_AUTH_TOKEN": "$api_key",
    "CLAUDE_CODE_MAX_OUTPUT_TOKENS": 20000,
    "DISABLE_TELEMETRY": 1,
    "DISABLE_ERROR_REPORTING": 1,
    "CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC": 1,
    "CLAUDE_BASH_MAINTAIN_PROJECT_WORKING_DIR": 1,
    "MAX_THINKING_TOKENS": 12000
  },
  "model": "sonnet"
}
EOF

    echo "Claude Code settings created successfully"
}

# Function to create Codex configuration
create_codex_config() {
    local base_url="$1"
    local api_key="$2"

    mkdir -p "$HOME/.codex"

    # Create config.toml
    cat > "$HOME/.codex/config.toml" << EOF
model_provider = "cccc"
model = "gpt-5-codex"
model_reasoning_effort = "high"

[Model_providers.cccc]
name = "cccc"
base_url = "${base_url}/v1"
wire_api = "responses"
env_key = "OPENAI_API_KEY"
EOF

    # Create auth.json
    cat > "$HOME/.codex/auth.json" << EOF
{
  "OPENAI_API_KEY": "$api_key",
  "CCCC_API_KEY": "$api_key"
}
EOF

    echo "Codex configuration created successfully"
}

# Main function
main() {
    echo ""
    echo "╔══════════════════════════════════════════════════════════════════════╗"
    echo "║                    CCCC  Unified Configuration                       ║"
    echo "║              Claude Code & Codex Companion Setup                     ║"
    echo "╚══════════════════════════════════════════════════════════════════════╝"
    echo ""

    # Interactive mode
    echo "交互式配置模式"
    echo ""

    # Get base URL
    read -p "Enter CCCC proxy URL [${DEFAULT_BASE_URL}]: " base_url
    base_url="${base_url:-$DEFAULT_BASE_URL}"

    # Get API key
    while [ -z "$api_key" ]; do
        read -p "Enter your API key: " api_key
        if [ -z "$api_key" ]; then
            echo "API key is required"
        fi
    done

    echo ""
    echo "配置信息："
    echo "  代理地址: $base_url"
    echo "  API 密钥: ${api_key:0:8}...${api_key: -4}"
    echo ""

    # Configure both clients
    echo "══════════════════════════════════════════════════════════════════════"
    echo "                    配置 Claude Code"
    echo "══════════════════════════════════════════════════════════════════════"
    create_claude_settings "$base_url" "$api_key"

    echo ""
    echo "══════════════════════════════════════════════════════════════════════"
    echo "                      配置 Codex"
    echo "══════════════════════════════════════════════════════════════════════"
    create_codex_config "$base_url" "$api_key"

    echo ""
    echo "╔══════════════════════════════════════════════════════════════════════╗"
    echo "║                    ✅ 配置完成！                                     ║"
    echo "╠══════════════════════════════════════════════════════════════════════╣"
    echo "║  ✓ Claude Code 已配置完成                                            ║"
    echo "║    使用命令: claude                                                  ║"
    echo "║                                                                      ║"
    echo "║  ✓ Codex 已配置完成                                                  ║"
    echo "║    使用命令: codex                                                   ║"
    echo "║                                                                      ║"
    echo "║  🌐 代理地址: $base_url                                              ║"
    echo "║                                                                      ║"
    echo "║  💡 提示: 如需重新配置，可再次运行本脚本                             ║"
    echo "╚══════════════════════════════════════════════════════════════════════╝"
    echo ""
}

# Run main function
main "$@"`;
            }

            const blob = new Blob([scriptContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
    </script>

    <style>
        /* Compact styles for better presentation */
        .hero-section {
            padding: 2rem 0 !important;
            min-height: auto !important;
        }

        .card-body {
            padding: 1rem !important;
        }

        .card-header {
            padding: 0.75rem 1rem !important;
        }

        .display-4 {
            font-size: 2rem !important;
            margin-bottom: 0.5rem !important;
        }

        .lead {
            font-size: 1rem !important;
            margin-bottom: 0.75rem !important;
        }

        .btn-lg {
            padding: 0.5rem 1rem !important;
            font-size: 1rem !important;
        }

        .fa-3x {
            font-size: 2rem !important;
        }

        .fa-2x {
            font-size: 1.5rem !important;
        }

        .mb-5 {
            margin-bottom: 1.5rem !important;
        }

        .mb-4 {
            margin-bottom: 1rem !important;
        }

        .mb-3 {
            margin-bottom: 0.75rem !important;
        }

        .mb-2 {
            margin-bottom: 0.5rem !important;
        }

        .py-3 {
            padding-top: 0.75rem !important;
            padding-bottom: 0.75rem !important;
        }

        .py-2 {
            padding-top: 0.5rem !important;
            padding-bottom: 0.5rem !important;
        }

        .g-2 {
            --bs-gutter-x: 0.5rem !important;
            --bs-gutter-y: 0.5rem !important;
        }

        .code-block {
            font-size: 0.8rem !important;
            padding: 0.5rem !important;
        }

        .btn-sm {
            padding: 0.25rem 0.5rem !important;
            font-size: 0.875rem !important;
        }

        .alert {
            margin-bottom: 0.75rem !important;
            padding: 0.5rem 0.75rem !important;
        }

        hr {
            margin: 0.5rem 0 !important;
        }
    </style>
</body>
</html>